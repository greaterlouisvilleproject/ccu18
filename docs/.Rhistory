map_at(c('nohs', 'hs', 'somecol', 'assoc', 'assoc_plus', 'bach', 'bach_plus', 'grad'), educ_replace) %>%
as.data.frame()
#generate employment variable at the household level
acs %<>%
mutate(emp = if_else(EMPSTAT == 1, 1, 0),
emp = replace(emp, EMPSTAT == 0, NA)) %>%
group_by(SERIAL, YEAR) %>%
mutate(fam_emp = if_else(any(emp == 1, na.rm = TRUE), 1, 0)) %>%
ungroup()
#generate working poverty variable
acs %<>%
mutate(working_poverty = if_else(fam_emp == 1 & pov == 1, 1, 0))
acs %<>%
mutate(unemp = if_else(EMPSTAT == 2, 1, 0))
acs$unemp[acs$EMPSTAT == 0] <- NA
acs$unemp[acs$EMPSTAT == 3] <- NA
acs %<>%
mutate(OWNCOST = replace(OWNCOST, OWNCOST == 99999, NA),
FTOTINC = replace(FTOTINC, FTOTINC == 99999, NA),
hcost   = max(OWNCOST, FTOTINC, na.rm = TRUE),
hcost_burdened = if_else(hcost*12/FTOTINC > .5, 1, 0))
#mpi_msa$hcost_burdened[is.na(mpi_msa$hcost_burdened)] <- 0
survey_df <- svydesign(ids = ~1, weights = ~PERWT, data = acs)
svy_child <- survey_df %>% subset(AGE < 18)
svy_young_child <- survey_df %>% subset(AGE < 5)
svy_df_old_child <- survey_df %>% subset(AGE >= 5 & AGE <= 17)
svy_25_34 <- survey_df %>% subset(AGE >= 25 & AGE <= 34)
svy_25_64 <- survey_df %>% subset(AGE >= 25 & AGE <= 64)
acs_hhold <- acs[!duplicated(acs[c('YEAR', 'SERIAL')]),]
survey_df_hhold <- svydesign(ids = ~1, weights = ~HHWT, data = acs_hhold)
#results <- svyby(~assoc_plus + bach_plus + grad + unemp + working_poverty, ~FIPS+YEAR+race, design = survey_df, svymean, na.rm = TRUE)
results <- svyby(~bach_plus, ~FIPS+YEAR+race, design = survey_df, svymean, na.rm = TRUE)
output <- results %>%
select(FIPS, race, year = YEAR, bach_plus) %>%
mutate_at(bach_plus, function(x) {x * 100}) %>%
{
x <- .
full_join(
x %>%
filter(race == 0) %>%
select(-race) %>%
rename(bach_w = bach),
x %>%
filter(race == 2) %>%
select(-race) %>%
rename(bach_b = bach),
by = c('FIPS', 'year'))
}
output <- results %>%
select(FIPS, race, year = YEAR, bach_plus) %>%
mutate_at(bach_plus, function(x) {x * 100}) %>%
{
x <- .
full_join(
x %>%
filter(race == 0) %>%
select(-race) %>%
rename(bach_w = bach_plus),
x %>%
filter(race == 2) %>%
select(-race) %>%
rename(bach_b = bach_plus),
by = c('FIPS', 'year'))
}
output <- results %>%
select(FIPS, race, year = YEAR, bach_plus) %>%
mutate_at(vars(bach_plus), function(x) {x * 100}) %>%
{
x <- .
full_join(
x %>%
filter(race == 0) %>%
select(-race) %>%
rename(bach_w = bach_plus),
x %>%
filter(race == 2) %>%
select(-race) %>%
rename(bach_b = bach_plus),
by = c('FIPS', 'year'))
}
output %<>% pull_peers_FIPS()
output$city <- NA
output$city[output$FIPS == 1073]  = 'Birmingham'
output$city[output$FIPS == 12031] = 'Jacksonville'
output$city[output$FIPS == 18097] = 'Indianapolis'
output$city[output$FIPS == 21111] = 'Louisville'
output$city[output$FIPS == 26081] = 'Grand Rapids'
output$city[output$FIPS == 29095] = 'Kansas City'
output$city[output$FIPS == 'MERGED'] = 'St. Louis'
output$city[output$FIPS == 31055] = 'Omaha'
output$city[output$FIPS == 37081] = 'Greensboro'
output$city[output$FIPS == 37119] = 'Charlotte'
output$city[output$FIPS == 37183] = 'Raleigh'
output$city[output$FIPS == 39049] = 'Columbus'
output$city[output$FIPS == 39061] = 'Cincinnati'
output$city[output$FIPS == 39113] = 'Dayton'
output$city[output$FIPS == 40109] = 'Oklahoma City'
output$city[output$FIPS == 40143] = 'Tulsa'
output$city[output$FIPS == 45045] = 'Greenville'
output$city[output$FIPS == 47037] = 'Nashville'
output$city[output$FIPS == 47093] = 'Knoxville'
output$city[output$FIPS == 47157] = 'Memphis'
output$city[output$FIPS == 51760] = 'Richmond'
source('C:/Users/Harrison Kirby/Desktop/GLP/glp_website/graphing_functions.R')
font_add("Museo Sans 300", "MuseoSans_300.otf")
font_add("Museo Sans 300 Italic", "MuseoSans_300_Italic.otf")
setwd('Images')
png("associates_white.png", 900, 600, res = 100, type = "cairo")
graph_trendline(output,
"assoc_w",
plot_title = "Associate Degrees or Higher, White, Ages 25-34",
rollmean = 3,
xmin = 2005,
xmax = 2015,
y_title = "Percent")
png("bach_black.png", 900, 600, res = 100, type = "cairo")
png("bach_black.png", 900, 600, res = 100, type = "cairo")
png("bach_black.png", 900, 600, res = 100, type = "cairo")
graph_trendline(output,
"bach_b",
plot_title = "Bachelor's Degrees or Higher, Hispanic, Ages 25-34",
rollmean = 3,
xmin = 2005,
xmax = 2015,
y_title = "Percent")
dev.off()
knitr::opts_knit$set(root.dir = "C:/Users/Harrison Kirby/Desktop/GLP/ccu18")
knitr::opts_chunk$set(message = FALSE, warning = FALSE, echo = FALSE, fig.showtext=TRUE)
#Data
library(survey)
library(tidyverse)
library(magrittr)
library(feather)
library(labelled)
#Graphing
library(ggthemes)
library(classInt)
library(showtext)
library(reshape2)
library(rbokeh)
library(wesanderson)
library(kableExtra)
library(scales)
#Mapping
library(rgdal)
library(RColorBrewer)
library(leaflet)
#Make the dplyr select function the default over the plotly select function
select <- function(...){dplyr::select(...)}
source('helper_functions.R')
source('graphing_functions.R')
font_add("Museo Sans 300", "MuseoSans_300.otf")
font_add("Museo Sans 300 Italic", "MuseoSans_300_Italic.otf")
#Tract Map
map_jc = readOGR('data/maps/tract', layer = "JC Tracts",
GDAL1_integer64_policy = TRUE, stringsAsFactors = FALSE, verbose = FALSE)
map_jc$TRACT <- as.numeric(map_jc$TRACT)
nh_names <- read_csv('data/maps/tract_to_nh.csv')
nh_names$Id2 <- substr(nh_names$Id2, 6, 13)
nh_names$Id2 <- as.numeric(nh_names$Id2)
map_jc@data <- full_join(map_jc@data, nh_names, by = c('TRACT' = 'Id2'))
map_jc@data$l_line1 <- paste("Tract #:", map_jc@data$TRACT, "in the")
map_jc@data$l_line2 <- paste(map_jc@data$Neighborhood, "neighborhood")
rm(nh_names)
#Zip Code map
map_jc_zip = readOGR('data/maps/zip', layer = 'Jefferson_County_KY_ZIP_Codes',
GDAL1_integer64_policy = TRUE, stringsAsFactors = FALSE, verbose = FALSE)
map_jc_zip$ZIPCODE <- as.numeric(map_jc_zip$ZIPCODE)
map_jc_zip@data$l_line1 <- paste0("Zip Code ", map_jc_zip@data$ZIPCODE)
web = TRUE
data <- read_csv('data/education/cps_00025.csv')
write_feather(data, 'data/education/certificates.feather')
certificates <- read_feather('data/education/certificates.feather')
certificates <- certificates[!duplicated(certificates$CPSIDP),]
certificates$city <- NA
certificates$city[certificates$METAREA == 3001] = "Grand Rapids"
certificates$city[certificates$METAREA == 7040] = "St. Louis"
certificates$city[certificates$METAREA == 5880] = "Oklahoma City"
certificates$city[certificates$METAREA == 8560] = "Tulsa"
certificates$city[certificates$METAREA == 3162] = "Greenville"
certificates$city[certificates$METAREA == 3840] = "Knoxville"
certificates$city[certificates$METAREA == 1001] = "Birmingham"
certificates$city[certificates$METAREA == 4520] = "Louisville"
certificates$city[certificates$METAREA == 3480] = "Indianapolis"
certificates$city[certificates$METAREA == 3760] = "Kansas City"
certificates$city[certificates$METAREA == 5921] = "Omaha"
certificates$city[certificates$METAREA == 3122] = "Greensboro"
certificates$city[certificates$METAREA == 1521] = "Charlotte"
certificates$city[certificates$METAREA == 1840] = "Columbus"
certificates$city[certificates$METAREA == 1641] = "Cincinnati"
certificates$city[certificates$METAREA == 5361] = "Nashville"
certificates$city[certificates$METAREA == 4920] = "Memphis"
certificates$city[certificates$METAREA == 3590] = "Jacksonville"
certificates$city[certificates$METAREA == 6642] = "Raleigh"
certificates$city[certificates$METAREA == 2002] = "Dayton"
certificates$city[certificates$METAREA == 6761] = "Richmond"
table(certificates$METRO)
table(certificates$COUNTY)
certificates <- certificates %>% filter(!is.na(city))
table(certificates$COUNTY)
table(certificates$COUNTY, certificates$city)
table(certificates$METRO, certificates$city)
table(certificates$METRO, certificates$COUNTY)
table(certificates$city, certificates$COUNTY)
table(certificates$COUNTY, certificates$city)
table(certificates$COUNTY, certificates$METRO)
table(certification$YEAR)
table(certificates$YEAR)
table(certificates$COUNTY, certificates$city)
table(certificates$METRO, certificates$city)
table(certificates$city, certificates$METRO, certificates$FIPS)
table(certificates$city, certificates$METRO, certificates$METFIPS)
table(certificates$city, certificates$METRO, certificates$COUNTY)
table(certificates$METFIPS)
table(certificates$METFIPS, certificates$city)
knitr::opts_knit$set(root.dir = "C:/Users/Harrison Kirby/Desktop/GLP/ccu18")
knitr::opts_chunk$set(message = FALSE, warning = FALSE, echo = FALSE, fig.showtext=TRUE)
#Data
library(survey)
library(tidyverse)
library(magrittr)
library(feather)
library(labelled)
#Graphing
library(ggthemes)
library(classInt)
library(showtext)
library(reshape2)
library(rbokeh)
library(wesanderson)
library(kableExtra)
library(scales)
#Mapping
library(rgdal)
library(RColorBrewer)
library(leaflet)
#Make the dplyr select function the default over the plotly select function
select <- function(...){dplyr::select(...)}
source('helper_functions.R')
source('graphing_functions.R')
font_add("Museo Sans 300", "MuseoSans_300.otf")
font_add("Museo Sans 300 Italic", "MuseoSans_300_Italic.otf")
#Tract Map
map_jc = readOGR('data/maps/tract', layer = "JC Tracts",
GDAL1_integer64_policy = TRUE, stringsAsFactors = FALSE, verbose = FALSE)
map_jc$TRACT <- as.numeric(map_jc$TRACT)
nh_names <- read_csv('data/maps/tract_to_nh.csv')
nh_names$Id2 <- substr(nh_names$Id2, 6, 13)
nh_names$Id2 <- as.numeric(nh_names$Id2)
map_jc@data <- full_join(map_jc@data, nh_names, by = c('TRACT' = 'Id2'))
map_jc@data$l_line1 <- paste("Tract #:", map_jc@data$TRACT, "in the")
map_jc@data$l_line2 <- paste(map_jc@data$Neighborhood, "neighborhood")
rm(nh_names)
#Zip Code map
map_jc_zip = readOGR('data/maps/zip', layer = 'Jefferson_County_KY_ZIP_Codes',
GDAL1_integer64_policy = TRUE, stringsAsFactors = FALSE, verbose = FALSE)
map_jc_zip$ZIPCODE <- as.numeric(map_jc_zip$ZIPCODE)
map_jc_zip@data$l_line1 <- paste0("Zip Code ", map_jc_zip@data$ZIPCODE)
web = TRUE
certificates <- read_feather('data/education/certificates.feather')
certificates <- certificates[!duplicated(certificates$CPSIDP),]
certificates %<>%
rename(MSA = METFIPS) %>%
pull_peers_MSA()
certificates$city <- NA
certificates$city[certificates$METAREA == 3001] = "Grand Rapids"
certificates$city[certificates$METAREA == 7040] = "St. Louis"
certificates$city[certificates$METAREA == 5880] = "Oklahoma City"
certificates$city[certificates$METAREA == 8560] = "Tulsa"
certificates$city[certificates$METAREA == 3162] = "Greenville"
certificates$city[certificates$METAREA == 3840] = "Knoxville"
certificates$city[certificates$METAREA == 1001] = "Birmingham"
certificates$city[certificates$METAREA == 4520] = "Louisville"
certificates$city[certificates$METAREA == 3480] = "Indianapolis"
certificates$city[certificates$METAREA == 3760] = "Kansas City"
certificates$city[certificates$METAREA == 5921] = "Omaha"
certificates$city[certificates$METAREA == 3122] = "Greensboro"
certificates$city[certificates$METAREA == 1521] = "Charlotte"
certificates$city[certificates$METAREA == 1840] = "Columbus"
certificates$city[certificates$METAREA == 1641] = "Cincinnati"
certificates$city[certificates$METAREA == 5361] = "Nashville"
certificates$city[certificates$METAREA == 4920] = "Memphis"
certificates$city[certificates$METAREA == 3590] = "Jacksonville"
certificates$city[certificates$METAREA == 6642] = "Raleigh"
certificates$city[certificates$METAREA == 2002] = "Dayton"
certificates$city[certificates$METAREA == 6761] = "Richmond"
cert_svy <- svydesign(ids = ~1, weights = ~WTFINL, data = certificates)
table(certification$PROFCERT)
table(certificates$PROFCERT)
table(certificates$PROFCERT, certificates$YEAR)
certificates <- read_feather('data/education/certificates.feather')
certificates %<>% filter(YEAR > 2014)
write_feather(certificates, 'data/education/certificates.feather')
certificates <- read_feather('data/education/certificates.feather')
certificates <- certificates[!duplicated(certificates$CPSIDP),]
certificates %<>%
rename(MSA = METFIPS) %>%
pull_peers_MSA() %>%
mutate(
certification = if_else(PROFCERT == 2, 1, 0),
certification = replace(certification, PROFCERT == 99, NA))
certificates$city <- NA
certificates$city[certificates$METAREA == 3001] = "Grand Rapids"
certificates$city[certificates$METAREA == 7040] = "St. Louis"
certificates$city[certificates$METAREA == 5880] = "Oklahoma City"
certificates$city[certificates$METAREA == 8560] = "Tulsa"
certificates$city[certificates$METAREA == 3162] = "Greenville"
certificates$city[certificates$METAREA == 3840] = "Knoxville"
certificates$city[certificates$METAREA == 1001] = "Birmingham"
certificates$city[certificates$METAREA == 4520] = "Louisville"
certificates$city[certificates$METAREA == 3480] = "Indianapolis"
certificates$city[certificates$METAREA == 3760] = "Kansas City"
certificates$city[certificates$METAREA == 5921] = "Omaha"
certificates$city[certificates$METAREA == 3122] = "Greensboro"
certificates$city[certificates$METAREA == 1521] = "Charlotte"
certificates$city[certificates$METAREA == 1840] = "Columbus"
certificates$city[certificates$METAREA == 1641] = "Cincinnati"
certificates$city[certificates$METAREA == 5361] = "Nashville"
certificates$city[certificates$METAREA == 4920] = "Memphis"
certificates$city[certificates$METAREA == 3590] = "Jacksonville"
certificates$city[certificates$METAREA == 6642] = "Raleigh"
certificates$city[certificates$METAREA == 2002] = "Dayton"
certificates$city[certificates$METAREA == 6761] = "Richmond"
cert_svy <- svydesign(ids = ~1, weights = ~WTFINL, data = certificates)
cert_df <- svyby(~certification, ~city, design = cert_svy, svymean, na.rm = TRUE)
View(cert_df)
cert_df <- svyby(~certification, ~city+year, design = cert_svy, svymean, na.rm = TRUE)
certificates <- read_feather('data/education/certificates.feather')
certificates <- certificates[!duplicated(certificates$CPSIDP),]
certificates %<>%
rename(MSA = METFIPS,
year = YEAR) %>%
pull_peers_MSA() %>%
mutate(
certification = if_else(PROFCERT == 2, 1, 0),
certification = replace(certification, PROFCERT == 99, NA))
certificates$city <- NA
certificates$city[certificates$METAREA == 3001] = "Grand Rapids"
certificates$city[certificates$METAREA == 7040] = "St. Louis"
certificates$city[certificates$METAREA == 5880] = "Oklahoma City"
certificates$city[certificates$METAREA == 8560] = "Tulsa"
certificates$city[certificates$METAREA == 3162] = "Greenville"
certificates$city[certificates$METAREA == 3840] = "Knoxville"
certificates$city[certificates$METAREA == 1001] = "Birmingham"
certificates$city[certificates$METAREA == 4520] = "Louisville"
certificates$city[certificates$METAREA == 3480] = "Indianapolis"
certificates$city[certificates$METAREA == 3760] = "Kansas City"
certificates$city[certificates$METAREA == 5921] = "Omaha"
certificates$city[certificates$METAREA == 3122] = "Greensboro"
certificates$city[certificates$METAREA == 1521] = "Charlotte"
certificates$city[certificates$METAREA == 1840] = "Columbus"
certificates$city[certificates$METAREA == 1641] = "Cincinnati"
certificates$city[certificates$METAREA == 5361] = "Nashville"
certificates$city[certificates$METAREA == 4920] = "Memphis"
certificates$city[certificates$METAREA == 3590] = "Jacksonville"
certificates$city[certificates$METAREA == 6642] = "Raleigh"
certificates$city[certificates$METAREA == 2002] = "Dayton"
certificates$city[certificates$METAREA == 6761] = "Richmond"
cert_svy <- svydesign(ids = ~1, weights = ~WTFINL, data = certificates)
cert_df <- svyby(~certification, ~city+year, design = cert_svy, svymean, na.rm = TRUE)
View(cert_df)
cert_df_lou =  svyby(~certification, ~year, design = subset(cert_svy, COUNTY == 21111), svymean, na.rm = TRUE) %>%
cert_df_lou =  svyby(~certification, ~year, design = subset(cert_svy, COUNTY == 21111), svymean, na.rm = TRUE)
cert_df_lou =  svyby(~certification, ~year, design = subset(cert_svy, cert_svy$COUNTY == 21111), svymean, na.rm = TRUE)
cert_df_lou =  svyby(~certification, ~year, design = subset(cert_svy, COUNTY == 21111), svymean, na.rm = TRUE)
View(cert_df_lou)
knitr::opts_knit$set(root.dir = "C:/Users/Harrison Kirby/Desktop/GLP/ccu18")
knitr::opts_chunk$set(message = FALSE, warning = FALSE, echo = FALSE, fig.showtext=TRUE)
#Data
library(survey)
library(tidyverse)
library(magrittr)
library(feather)
library(labelled)
#Graphing
library(ggthemes)
library(classInt)
library(showtext)
library(reshape2)
library(rbokeh)
library(wesanderson)
library(kableExtra)
library(scales)
#Mapping
library(rgdal)
library(RColorBrewer)
library(leaflet)
#Make the dplyr select function the default over the plotly select function
select <- function(...){dplyr::select(...)}
source('helper_functions.R')
source('graphing_functions.R')
font_add("Museo Sans 300", "MuseoSans_300.otf")
font_add("Museo Sans 300 Italic", "MuseoSans_300_Italic.otf")
#Tract Map
map_jc = readOGR('data/maps/tract', layer = "JC Tracts",
GDAL1_integer64_policy = TRUE, stringsAsFactors = FALSE, verbose = FALSE)
map_jc$TRACT <- as.numeric(map_jc$TRACT)
nh_names <- read_csv('data/maps/tract_to_nh.csv')
nh_names$Id2 <- substr(nh_names$Id2, 6, 13)
nh_names$Id2 <- as.numeric(nh_names$Id2)
map_jc@data <- full_join(map_jc@data, nh_names, by = c('TRACT' = 'Id2'))
map_jc@data$l_line1 <- paste("Tract #:", map_jc@data$TRACT, "in the")
map_jc@data$l_line2 <- paste(map_jc@data$Neighborhood, "neighborhood")
rm(nh_names)
#Zip Code map
map_jc_zip = readOGR('data/maps/zip', layer = 'Jefferson_County_KY_ZIP_Codes',
GDAL1_integer64_policy = TRUE, stringsAsFactors = FALSE, verbose = FALSE)
map_jc_zip$ZIPCODE <- as.numeric(map_jc_zip$ZIPCODE)
map_jc_zip@data$l_line1 <- paste0("Zip Code ", map_jc_zip@data$ZIPCODE)
web = TRUE
degree_df <- acs_time("/data/education/B15001/")
degree_df %<>%
mutate(
num_25_34 =
`Estimate; Male: - 25 to 34 years:` +
`Estimate; Female: - 25 to 34 years:`,
num_25_64 =
`Estimate; Male: - 25 to 34 years:` +
`Estimate; Male: - 35 to 44 years:` +
`Estimate; Male: - 45 to 64 years:` +
`Estimate; Female: - 25 to 34 years:` +
`Estimate; Female: - 35 to 44 years:` +
`Estimate; Female: - 45 to 64 years:`,
num_25_34_grad =
`Estimate; Male: - 25 to 34 years: - Graduate or professional degree` +
`Estimate; Female: - 25 to 34 years: - Graduate or professional degree`,
num_25_64_grad =
`Estimate; Male: - 25 to 34 years: - Graduate or professional degree` +
`Estimate; Male: - 35 to 44 years: - Graduate or professional degree` +
`Estimate; Male: - 45 to 64 years: - Graduate or professional degree` +
`Estimate; Female: - 25 to 34 years: - Graduate or professional degree` +
`Estimate; Female: - 35 to 44 years: - Graduate or professional degree` +
`Estimate; Female: - 45 to 64 years: - Graduate or professional degree`,
num_25_34_bach_plus =
`Estimate; Male: - 25 to 34 years: - Bachelor's degree` +
`Estimate; Female: - 25 to 34 years: - Bachelor's degree` +
num_25_34_grad,
num_25_64_bach_plus =
`Estimate; Male: - 25 to 34 years: - Bachelor's degree` +
`Estimate; Male: - 35 to 44 years: - Bachelor's degree` +
`Estimate; Male: - 45 to 64 years: - Bachelor's degree` +
`Estimate; Female: - 25 to 34 years: - Bachelor's degree` +
`Estimate; Female: - 35 to 44 years: - Bachelor's degree` +
`Estimate; Female: - 45 to 64 years: - Bachelor's degree` +
num_25_64_grad,
num_25_34_assoc_plus =
`Estimate; Male: - 25 to 34 years: - Associate's degree` +
`Estimate; Female: - 25 to 34 years: - Associate's degree` +
num_25_34_bach_plus,
num_25_64_assoc_plus =
`Estimate; Male: - 25 to 34 years: - Associate's degree` +
`Estimate; Male: - 35 to 44 years: - Associate's degree` +
`Estimate; Male: - 45 to 64 years: - Associate's degree` +
`Estimate; Female: - 25 to 34 years: - Associate's degree` +
`Estimate; Female: - 35 to 44 years: - Associate's degree` +
`Estimate; Female: - 45 to 64 years: - Associate's degree` +
num_25_64_bach_plus,
per_25_34_assoc_plus = num_25_34_assoc_plus / num_25_34 * 100,
per_25_64_assoc_plus = num_25_64_assoc_plus / num_25_64 * 100,
per_25_34_bach_plus = num_25_34_bach_plus / num_25_34 * 100,
per_25_64_bach_plus = num_25_64_bach_plus / num_25_64 * 100,
per_25_34_grad = num_25_34_grad / num_25_34 * 100,
per_25_64_grad = num_25_64_grad / num_25_64 * 100) %>%
{
x <- .
full_join(
x %>% weight_stl(c('per_25_34_assoc_plus', 'per_25_34_bach_plus', 'per_25_34_grad'), 'num_25_34'),
x %>% weight_stl(c('per_25_64_assoc_plus', 'per_25_64_bach_plus', 'per_25_64_grad'), 'num_25_64'))
}
data <- degree_df
data %<>% pull_peers_FIPS() %>% select(FIPS, city, year, current, baseline, everything())
rm(degree_df)
certificates <- read_feather('data/education/certificates.feather')
certificates <- certificates[!duplicated(certificates$CPSIDP),]
certificates %<>%
rename(MSA = METFIPS,
year = YEAR) %>%
pull_peers_MSA() %>%
mutate(
certification = if_else(PROFCERT == 2, 1, 0),
certification = replace(certification, PROFCERT == 99, NA))
certificates$city <- NA
certificates$city[certificates$METAREA == 3001] = "Grand Rapids"
certificates$city[certificates$METAREA == 7040] = "St. Louis"
certificates$city[certificates$METAREA == 5880] = "Oklahoma City"
certificates$city[certificates$METAREA == 8560] = "Tulsa"
certificates$city[certificates$METAREA == 3162] = "Greenville"
certificates$city[certificates$METAREA == 3840] = "Knoxville"
certificates$city[certificates$METAREA == 1001] = "Birmingham"
certificates$city[certificates$METAREA == 4520] = "Louisville"
certificates$city[certificates$METAREA == 3480] = "Indianapolis"
certificates$city[certificates$METAREA == 3760] = "Kansas City"
certificates$city[certificates$METAREA == 5921] = "Omaha"
certificates$city[certificates$METAREA == 3122] = "Greensboro"
certificates$city[certificates$METAREA == 1521] = "Charlotte"
certificates$city[certificates$METAREA == 1840] = "Columbus"
certificates$city[certificates$METAREA == 1641] = "Cincinnati"
certificates$city[certificates$METAREA == 5361] = "Nashville"
certificates$city[certificates$METAREA == 4920] = "Memphis"
certificates$city[certificates$METAREA == 3590] = "Jacksonville"
certificates$city[certificates$METAREA == 6642] = "Raleigh"
certificates$city[certificates$METAREA == 2002] = "Dayton"
certificates$city[certificates$METAREA == 6761] = "Richmond"
cert_svy <- svydesign(ids = ~1, weights = ~WTFINL, data = certificates)
cert_df <- svyby(~certification, ~city+year, design = cert_svy, svymean, na.rm = TRUE) %>%
select(-se) %>%
mutate(certification = certification * 100)
cert_df_lou =  svyby(~certification, ~year, design = subset(cert_svy, COUNTY == 21111), svymean, na.rm = TRUE)
data %<>% bind_df(cert_df)
data %<>% full_join(cert_df, by = c('city', 'year'))
View(data)
View(data)
