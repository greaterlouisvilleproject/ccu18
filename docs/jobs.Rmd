---
title: "Jobs"
---
<div style="margin-top:50px;">
</div>
```{r "setup", include = FALSE}
knitr::opts_knit$set(root.dir = "C:/Users/Harrison Kirby/Desktop/GLP/ccu18")
knitr::opts_chunk$set(message = FALSE, warning = FALSE, echo = FALSE, fig.showtext=TRUE)
```

```{r libraries}
#Data
library(survey)
library(tidyverse)
library(magrittr)
library(feather)
library(labelled)

#Graphing
library(ggthemes)
library(classInt)
library(showtext)
library(reshape2)
library(plotly)
library(wesanderson)
library(kableExtra)
library(scales)

#Mapping
library(rgdal)
library(RColorBrewer)
library(leaflet)

#Make the dplyr select function the default over the plotly select function
select <- function(...){dplyr::select(...)}
```

```{r functions}
source('helper_functions.R')
```

```{r graphing}
source('graphing_functions.R')

font_add("Museo Sans 300", "MuseoSans_300.otf")
font_add("Museo Sans 300 Italic", "MuseoSans_300_Italic.otf")

#Tract Map
map_jc = readOGR('data/maps/tract', layer = "JC Tracts",
                 GDAL1_integer64_policy = TRUE, stringsAsFactors = FALSE, verbose = FALSE)

map_jc$TRACT <- as.numeric(map_jc$TRACT)

nh_names <- read_csv('data/maps/tract_to_nh.csv')

nh_names$Id2 <- substr(nh_names$Id2, 6, 13)
nh_names$Id2 <- as.numeric(nh_names$Id2)

map_jc@data <- full_join(map_jc@data, nh_names, by = c('TRACT' = 'Id2'))

map_jc@data$l_line1 <- paste("Tract #:", map_jc@data$TRACT, "in the")
map_jc@data$l_line2 <- paste(map_jc@data$Neighborhood, "neighborhood")

rm(nh_names)

#Zip Code map
map_jc_zip = readOGR('data/maps/zip', layer = 'Jefferson_County_KY_ZIP_Codes',
                     GDAL1_integer64_policy = TRUE, stringsAsFactors = FALSE, verbose = FALSE)

map_jc_zip$ZIPCODE <- as.numeric(map_jc_zip$ZIPCODE)

map_jc_zip@data$l_line1 <- paste0("Zip Code ", map_jc_zip@data$ZIPCODE)
```

```{r Website / output toggle}
web = TRUE
```

# Median earnings

## Ranking
```{r data9}
earn_data <- acs_time("/data/jobs/S2001/")

earn_data <- earn_data %>%
  select(FIPS, 
         year,
         median_earnings = `Total; Estimate; Population 16 years and over with earnings - Median earnings (dollars)`) %>%
  mutate(median_earnings = as.numeric(as.character(median_earnings)),
         FIPS = as.character(FIPS)) %>%
  weight_stl('median_earnings')

data <- earn_data

data %<>% pull_peers_FIPS() %>% select(FIPS, city, year, current, baseline, everything())

rm(earn_data)
```

```{r}
rpp <- read_csv("data/jobs/rppmsa.csv", skip = 4, col_names = TRUE, na = c("", "(NA)"))

rpp$`2005` <- rpp$`2008`
rpp$`2006` <- rpp$`2008`
rpp$`2007` <- rpp$`2008`
rpp$`2016` <- rpp$`2015`

rpp <- rpp %>%
  filter(LineCode == 4) %>%
  select(-GeoFips, -LineCode, -Description) %>%
  gather(2:13, key = year, value = "rpp") %>%
  mutate(year = as.numeric(year))

rpp$MSA <- substr(rpp$GeoName, 0, unlist(gregexpr(pattern = " \\(", rpp$GeoName)) -1 )

rpp$MSA[rpp$MSA == "Grand Rapids-Wyoming, MI"] = "Grand Rapids"
rpp$MSA[rpp$MSA == "St. Louis, MO-IL"] = "St. Louis"
rpp$MSA[rpp$MSA == "Oklahoma City, OK"] = "Oklahoma City"
rpp$MSA[rpp$MSA == "Tulsa, OK"] = "Tulsa"
rpp$MSA[rpp$MSA == "Greenville-Anderson-Mauldin, SC"] = "Greenville"
rpp$MSA[rpp$MSA == "Knoxville, TN"] = "Knoxville"
rpp$MSA[rpp$MSA == "Birmingham-Hoover, AL"] = "Birmingham"
rpp$MSA[rpp$MSA == "Louisville/Jefferson County, KY-IN"] = "Louisville"
rpp$MSA[rpp$MSA == "Indianapolis-Carmel-Anderson, IN"] = "Indianapolis"
rpp$MSA[rpp$MSA == "Kansas City, MO-KS"] = "Kansas City"
rpp$MSA[rpp$MSA == "Omaha-Council Bluffs, NE-IA"] = "Omaha"
rpp$MSA[rpp$MSA == "Greensboro-High Point, NC"] = "Greensboro"
rpp$MSA[rpp$MSA == "Charlotte-Concord-Gastonia, NC-SC"] = "Charlotte"
rpp$MSA[rpp$MSA == "Columbus, OH"] = "Columbus"
rpp$MSA[rpp$MSA == "Cincinnati, OH-KY-IN"] = "Cincinnati"
rpp$MSA[rpp$MSA == "Nashville-Davidson--Murfreesboro--Franklin, TN"] = "Nashville"
rpp$MSA[rpp$MSA == "Memphis, TN-MS-AR"] = "Memphis"
rpp$MSA[rpp$MSA == "Jacksonville, FL"] = "Jacksonville"
rpp$MSA[rpp$MSA == "Raleigh, NC"] = "Raleigh"
rpp$MSA[rpp$MSA == "Dayton, OH"] = "Dayton"
rpp$MSA[rpp$MSA == "Richmond, VA"] = "Richmond"

rpp %<>% select(-GeoName)

data %<>% left_join(rpp, by = c('year' = 'year', 'city' = 'MSA'))

data %<>%
  group_by(year) %>%
  mutate(rpp_lou = rpp[city == "Louisville"],
         rpp_index = rpp_lou / rpp) %>%
  ungroup() %>%
  select(-rpp, -rpp_lou)

cpi <- read_csv("data/jobs/CPI-U-RS.csv")

cpi %<>%
  rename(year = YEAR,
         cpi = AVG)

data %<>% left_join(cpi, by = "year")

data %<>%
  group_by(city) %>%
  mutate(base_cpi = cpi[year == 2016],
         cpi_index = base_cpi/cpi) %>%
  ungroup() %>%
  select(-cpi, -base_cpi)

data %<>% mutate(median_earnings = median_earnings * rpp_index * cpi_index)

rm(rpp, cpi)
```

```{r graph9}
rank_and_nb_group(data[data$year == 2016,], 
                  'median_earnings', 
                  plot_title = 'Median Earnings, 2016')
```

## Trendline {.tabset}
```{r data10}
earn_data_white <- acs_time("/data/jobs/B20017H/")

earn_data_white <- earn_data_white %>%
  select(FIPS, 
         year,
         median_earnings_white = `Estimate; Total:`) %>%
  mutate(FIPS = as.character(FIPS),
         median_earnings_white = as.numeric(as.character(median_earnings_white))) %>%
  weight_stl('median_earnings_white')

earn_data_black <- acs_time("/data/jobs/B20017B/")

earn_data_black <- earn_data_black %>%
  select(FIPS, 
         year,
         median_earnings_black = `Estimate; Total:`) %>%
  mutate(FIPS = as.character(FIPS),
         median_earnings_black = as.numeric(as.character(median_earnings_black))) %>%
  weight_stl('median_earnings_black')

earn_data_hisp <- acs_time("/data/jobs/B20017I/")

earn_data_hisp <- earn_data_hisp %>%
  select(FIPS, 
         year,
         median_earnings_hispanic = `Estimate; Total:`) %>%
  mutate(FIPS = as.character(FIPS),
         median_earnings_hispanic = as.numeric(as.character(median_earnings_hispanic))) %>%
  weight_stl('median_earnings_hispanic')

data %<>% bind_df(earn_data_white, earn_data_black, earn_data_hisp) %>%
  mutate_at(vars(median_earnings_white, median_earnings_black, median_earnings_hispanic), rpp_col_adj)

rm(earn_data_white, earn_data_black, earn_data_hisp)
```

### Overall
```{r graph 10.1}
graph_trendline(data,
                'median_earnings',
                plot_title = 'Median Earnings',
                y_title = 'Dollars')
```

### By Ethnicity

```{r graph10.2}
graph_df <- data %>%
  filter(FIPS == 21111)%>%
  select(year, median_earnings_white, median_earnings_black, median_earnings_hispanic)%>%
  gather(median_earnings_white:median_earnings_hispanic, 
         key = "var", value = "value")%>%
  arrange(var)

graph_df$var <- factor(graph_df$var, levels = unique(graph_df$var))

graph_trendline_race(
  graph_df,
  xmin = 2005,
  xmax = 2016,
  plot_title = "Median Earnings by Ethnicity",
  labels = c("African American", "Hispanic", "White"),
  y_title = "Dollars",
  color_pal = wes_palette("Moonrise2"))
```

```{r graph 10.3}
graph_trendline_race_peer(data, 
                          vars = c('median_earnings_white', 'median_earnings_black', 'median_earnings_hispanic'),
                          plot_title = 'Median Earnings by Ethnicity',
                          rollmean = 3,
                          y_title = 'Dollars')
```

## Map
```{r data11}
earn_map <- read_csv("data/jobs/ACS_16_5YR_S2001_with_ann.csv", skip = 1,
                      col_types = cols(
                      `Total; Estimate; Median earnings (dollars)` = col_number())
                   ) 

earn_map %<>% select(Id, median_earnings = `Total; Estimate; Median earnings (dollars)`)
```

```{r graph11}
map_jc@data <- full_join(map_jc@data, earn_map, by = c('GEO_ID' = 'Id'))

make_map("median_earnings", 
         name = "Median Earnings",
         legend_title = "Median<br/>Earnings",
         units = "Dollars")

rm(earn_map)
```

# Peer City Highlight: High Wage Occupations
```{r data12}
high_wage <- read_csv('C:/Users/Harrison Kirby/Desktop/GLP/glp_website/output data/education_data_fips.csv')
```

```{r graph12}
rank_and_nb_group(high_wage,
                  'per_high_wage',
                  plot_title = 'High Wage Occupations')

graph_trendline(high_wage,
                'per_high_wage',
                plot_title = 'High Wage Occupations',
                rollmean = 3)

graph_trendline_change(high_wage,
                 'per_high_wage',
                 plot_title = 'High Wage Occupations')
```


# Earnings Gap
```{r data13}
data %<>%
  mutate(earnings_gap_black = median_earnings_white - median_earnings_black,
         earnings_gap_hispanic = median_earnings_white - median_earnings_hispanic)
```

```{r graph13}
graph_trendline(data,
                'earnings_gap_black',
                plot_title = 'Earnings Gap: Black and White Residents',
                y_title = "Dollars",
                rollmean = 5)

graph_trendline(data,
                'earnings_gap_hispanic',
                plot_title = 'Earnings Gap: Hispanic and White Residents',
                y_title = "Dollars",
                rollmean = 5)
```



# Maps {.tabset}
```{r data14}
business_data <- read_csv('data/jobs/BP_2016_00CZ1_with_ann.csv', skip = 1)

#Join to Louisville Zip codes
zip_codes <- read_csv('data/jobs/zcta_county_rel_10.csv')

zip_codes %<>% 
  filter(GEOID == 21111) %>%
  select(zip = ZCTA5,
         pop = ZPOP)

zip_codes$pop <- replace(zip_codes$pop, zip_codes$pop < 500, NA)
zip_codes$pop[zip_codes$zip == 40202] <- NA

business_data <- zip_codes %>% 
  left_join(business_data, by = c('zip' = 'Id2'))

business_data <- business_data[,c(1, 2, 8, 9, 11)]

business_data %<>%
  mutate(businesses = `Number of establishments`,
         employees  = as.numeric(`Paid employees for pay period including March 12 (number)`),
         payroll    = as.numeric(`Annual payroll ($1,000)`) * 1000) %>%
  mutate(businesses_per_resident = businesses / pop,
         jobs_per_resident = employees / pop,
         payroll_per_resident = payroll / pop,
         payroll_per_job = payroll / employees) %>%
  select(zip,
         businesses_per_resident, jobs_per_resident, payroll_per_resident, payroll_per_job)

map_data_zip <- business_data

rm(zip_codes, business_data)

#a = 0-19
#e = 250-499
#g = 1,000 to 2,499
```

```{r graph14}
map_jc_zip@data <- full_join(map_jc_zip@data, map_data_zip, by = c('ZIPCODE' = 'zip'))
```

I removed some zip codes with very low population to avod skewing the numbers. I also removed downtown because it is so diffferent from everywhere else in the county: if it is included, the rest of the map is white and it is difficult to discern diffrences among the rest of the county.

## Businesses per resident
```{r graph14.1}
make_map_zip("businesses_per_resident", 
             name = "Businesses per Resident",
             legend_title = "Businesses<br/>per res",
             units = "none")
```

## Jobs per resident
```{r graph14.2}
make_map_zip("jobs_per_resident", 
             name = "Jobs per Resident",
             legend_title = "Jobs<br/>per res",
             units = "none")
```

## Payroll per resident
```{r graph14.3}
make_map_zip("payroll_per_resident", 
             name = "Payroll per Resident",
             legend_title = "Payroll<br/>per res",
             units = "Dollars")
```

## Payroll per worker
```{r graph14.4}
make_map_zip("payroll_per_job", 
             name = "Payroll per Worker",
             legend_title = "Payroll<br/>per worker",
             units = "Dollars")
```

# Unemployment {.tabset}


## Overall

```{r graph15.1}
unemp <- read_csv('C:/Users/Harrison Kirby/Desktop/GLP/glp_website/output data/jobs_data_fips.csv')
```

```{r graph 15.1}
graph_trendline(unemp,
                'unemployment',
                plot_title = 'Unemployment')
```

## By Ethnicity
```{r data15}
#White
unemp_white <- acs_time("/data/jobs/B23002H/", starting_year = 2005)

unemp_white %<>%
  mutate(
    total = 
      `Estimate; Male: - 16 to 19 years: - In labor force: - Civilian:` +
      `Estimate; Male: - 20 to 24 years: - In labor force: - Civilian:` +
      `Estimate; Male: - 25 to 54 years: - In labor force: - Civilian:` +
      `Estimate; Male: - 55 to 64 years: - In labor force: - Civilian:` +
      `Estimate; Male: - 65 to 69 years: - In labor force:` +
      `Estimate; Male: - 70 years and over: - In labor force:` +
      `Estimate; Female: - 16 to 19 years: - In labor force: - Civilian:` +
      `Estimate; Female: - 20 to 24 years: - In labor force: - Civilian:` +
      `Estimate; Female: - 25 to 54 years: - In labor force: - Civilian:` +
      `Estimate; Female: - 55 to 64 years: - In labor force: - Civilian:` +
      `Estimate; Female: - 65 to 69 years: - In labor force:` +
      `Estimate; Female: - 70 years and over: - In labor force:`,
    
    unemp_white = 
      (`Estimate; Male: - 16 to 19 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Male: - 20 to 24 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Male: - 25 to 54 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Male: - 55 to 64 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Male: - 65 to 69 years: - In labor force: - Unemployed` + 
      `Estimate; Male: - 70 years and over: - In labor force: - Unemployed` +
      `Estimate; Female: - 16 to 19 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Female: - 20 to 24 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Female: - 25 to 54 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Female: - 55 to 64 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Female: - 65 to 69 years: - In labor force: - Unemployed` + 
      `Estimate; Female: - 70 years and over: - In labor force: - Unemployed`)
      / total * 100) %>%
  weight_stl('unemp_white', 'total')

#Black
unemp_black <- acs_time("/data/jobs/B23002B/", starting_year = 2005)

unemp_black %<>%
  mutate(
    total = 
      `Estimate; Male: - 16 to 19 years: - In labor force: - Civilian:` +
      `Estimate; Male: - 20 to 24 years: - In labor force: - Civilian:` +
      `Estimate; Male: - 25 to 54 years: - In labor force: - Civilian:` +
      `Estimate; Male: - 55 to 64 years: - In labor force: - Civilian:` +
      `Estimate; Male: - 65 to 69 years: - In labor force:` +
      `Estimate; Male: - 70 years and over: - In labor force:` +
      `Estimate; Female: - 16 to 19 years: - In labor force: - Civilian:` +
      `Estimate; Female: - 20 to 24 years: - In labor force: - Civilian:` +
      `Estimate; Female: - 25 to 54 years: - In labor force: - Civilian:` +
      `Estimate; Female: - 55 to 64 years: - In labor force: - Civilian:` +
      `Estimate; Female: - 65 to 69 years: - In labor force:` +
      `Estimate; Female: - 70 years and over: - In labor force:`,
    
    unemp_black = 
      (`Estimate; Male: - 16 to 19 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Male: - 20 to 24 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Male: - 25 to 54 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Male: - 55 to 64 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Male: - 65 to 69 years: - In labor force: - Unemployed` + 
      `Estimate; Male: - 70 years and over: - In labor force: - Unemployed` +
      `Estimate; Female: - 16 to 19 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Female: - 20 to 24 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Female: - 25 to 54 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Female: - 55 to 64 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Female: - 65 to 69 years: - In labor force: - Unemployed` + 
      `Estimate; Female: - 70 years and over: - In labor force: - Unemployed`)
      / total * 100) %>%
  weight_stl('unemp_black', 'total')

#Hispanic
unemp_hisp <- acs_time("/data/jobs/B23002I/", starting_year = 2005)

unemp_hisp %<>%
  mutate(
    total = 
      `Estimate; Male: - 16 to 19 years: - In labor force: - Civilian:` +
      `Estimate; Male: - 20 to 24 years: - In labor force: - Civilian:` +
      `Estimate; Male: - 25 to 54 years: - In labor force: - Civilian:` +
      `Estimate; Male: - 55 to 64 years: - In labor force: - Civilian:` +
      `Estimate; Male: - 65 to 69 years: - In labor force:` +
      `Estimate; Male: - 70 years and over: - In labor force:` +
      `Estimate; Female: - 16 to 19 years: - In labor force: - Civilian:` +
      `Estimate; Female: - 20 to 24 years: - In labor force: - Civilian:` +
      `Estimate; Female: - 25 to 54 years: - In labor force: - Civilian:` +
      `Estimate; Female: - 55 to 64 years: - In labor force: - Civilian:` +
      `Estimate; Female: - 65 to 69 years: - In labor force:` +
      `Estimate; Female: - 70 years and over: - In labor force:`,
    
    unemp_hisp = 
      (`Estimate; Male: - 16 to 19 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Male: - 20 to 24 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Male: - 25 to 54 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Male: - 55 to 64 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Male: - 65 to 69 years: - In labor force: - Unemployed` + 
      `Estimate; Male: - 70 years and over: - In labor force: - Unemployed` +
      `Estimate; Female: - 16 to 19 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Female: - 20 to 24 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Female: - 25 to 54 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Female: - 55 to 64 years: - In labor force: - Civilian: - Unemployed` +
      `Estimate; Female: - 65 to 69 years: - In labor force: - Unemployed` + 
      `Estimate; Female: - 70 years and over: - In labor force: - Unemployed`)
      / total * 100) %>%
  weight_stl('unemp_hisp', 'total')

data %<>% bind_df(unemp_white, unemp_black, unemp_hisp)

rm(unemp_white, unemp_black, unemp_hisp)

```

Note: Hispanic residents are not included due to issues with sample size, but the data is forthcoming.
```{r graph15}
graph_df <- data %>%
  filter(FIPS == 21111)%>%
  select(year, unemp_white, unemp_black, unemp_hisp)%>%
  gather(unemp_white:unemp_hisp, 
         key = "var", value = "value")%>%
  arrange(var)

graph_df$var <- factor(graph_df$var, levels = unique(graph_df$var))

graph_trendline_race(
  graph_df,
  xmin = 2005,
  xmax = 2016,
  plot_title = "Unemployment by Ethnicity",
  labels = c("African American", "Hispanic", "White"),
  y_title = "Percent",
  color_pal = wes_palette("Moonrise2"))
```

# Brain Drain {.tabset}

## Net Migration
```{r data29}
inflow <- acs_time('/data/qop/B07009/')

inflow %<>%
  transmute(
    FIPS = FIPS,
    year = year,
    
    in_no_hs = 
      `Estimate; Moved from different county within same state: - Less than high school graduate` +
      `Estimate; Moved from different state: - Less than high school graduate` + 
      `Estimate; Moved from abroad: - Less than high school graduate`,
      
    in_hs =
      `Estimate; Moved from different county within same state: - High school graduate (includes equivalency)` +
      `Estimate; Moved from different state: - High school graduate (includes equivalency)` +
      `Estimate; Moved from abroad: - High school graduate (includes equivalency)`,
    
    in_some_col_assoc = 
      `Estimate; Moved from different county within same state: - Some college or associate's degree` +
      `Estimate; Moved from different state: - Some college or associate's degree` +
      `Estimate; Moved from abroad: - Some college or associate's degree`,
    
    in_bach = 
      `Estimate; Moved from different county within same state: - Bachelor's degree` +
      `Estimate; Moved from different state: - Bachelor's degree` +
      `Estimate; Moved from abroad: - Bachelor's degree`,
    
    in_grad = 
      `Estimate; Moved from different county within same state: - Graduate or professional degree` +
      `Estimate; Moved from different state: - Graduate or professional degree` +
      `Estimate; Moved from abroad: - Graduate or professional degree`,
      
    in_bach_plus = in_bach + in_grad) %>%
  mutate(FIPS = replace(FIPS, FIPS == '29189' | FIPS == '29510', 'MERGED')) %>%
  group_by(FIPS, year) %>%
  summarise_all(sum) %>%
  ungroup()


outflow <- acs_time('/data/qop/B07409/', starting_year = 2007)

outflow %<>%
  transmute(
    FIPS = FIPS,
    year = year,
    
    out_no_hs = 
      `Estimate; Moved to different county within same state: - Less than high school graduate` +
      `Estimate; Moved to different state: - Less than high school graduate`,
    
    out_hs = 
      `Estimate; Moved to different county within same state: - High school graduate (includes equivalency)` +
      `Estimate; Moved to different state: - High school graduate (includes equivalency)`,
    
    out_some_col_assoc = 
      `Estimate; Moved to different county within same state: - Some college or associate's degree` +
      `Estimate; Moved to different state: - Some college or associate's degree`,
    
    out_bach = 
      `Estimate; Moved to different county within same state: - Bachelor's degree` +
      `Estimate; Moved to different state: - Bachelor's degree`,
    
    out_grad = 
      `Estimate; Moved to different county within same state: - Graduate or professional degree` +
      `Estimate; Moved to different state: - Graduate or professional degree`,
    
    out_bach_plus = out_bach + out_grad) %>%
  mutate(FIPS = replace(FIPS, FIPS == '29189' | FIPS == '29510', 'MERGED')) %>%
  group_by(FIPS, year) %>%
  summarise_all(sum) %>%
  ungroup()

migration <- full_join(inflow, outflow)

migration %<>%
  mutate(
    net_no_hs = in_no_hs - out_no_hs,
    net_hs = in_hs - out_hs,
    net_some_col_assoc = in_some_col_assoc - out_some_col_assoc,
    net_bach = in_bach - out_bach,
    net_grad = in_grad - out_grad,
    net_bach_plus = in_bach_plus - out_bach_plus)

data %<>% bind_df(migration)

rm(inflow, outflow, migration)
```

```{r graph29.5}
graph_trendline(data,
                'net_bach',
                plot_title = 'Net Migration: Bachelor Degree Holders',
                xmin = 2007,
                rollmean = 3,
                y_title = "Residents")

graph_trendline(data,
                'net_grad',
                plot_title = 'Net Migration: Graduate Degree Holders',
                xmin = 2007,
                rollmean = 3,
                y_title = "Residents")
```

This graph shows single-year estimates.
```{r graph 29.6}
graph_trendline(data,
                'net_bach_plus',
                plot_title = 'Net Migration: Bachelor Degree or Higher',
                xmin = 2007,
                y_title = "Residents")
```

```{r graph29.2, eval = FALSE}
graph_trendline(data,
                'in_bach')

graph_trendline(data,
                'out_bach_plus')
```

